{% extends "base.html" %}

{% block title %}{{ accion }} Título - CineHub{% endblock %}

{% block content %}
<div class="container">
    <div class="form-container">
        <div class="form-header">
            <h1>
                <i class="fas fa-film"></i>
                {{ accion }} Título
            </h1>
            <a href="/web/titulos" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver
            </a>
        </div>

        {% if error_message %}
        <div class="alert alert-error">
            <i class="fas fa-exclamation-triangle"></i> {{ error_message }}
        </div>
        {% endif %}

        <form method="post"  class="data-form" enctype="multipart/form-data">
            <div class="form-group">
                <label><i class="fas fa-heading"></i> Título:</label>
                <input type="text" name="titulo" value="{% if error_message %}{{ form_data.titulo }}{% elif titulo %}{{ titulo.titulo }}{% endif %}" required>
            </div>

           <div class="form-group">
                <label><i class="fas fa-theater-masks"></i> Género:</label>
                {% set lista_generos = [
                    'Acción', 'Aventura', 'Animación', 'Biografía', 'Ciencia Ficción',
                    'Comedia', 'Crimen', 'Documental', 'Drama', 'Familia',
                    'Fantasía', 'Historia', 'Misterio', 'Musical', 'Romance',
                    'Suspenso', 'Terror', 'Western'
                ] %}
                {% set selected_genero = form_data.genero if error_message else (titulo.genero if titulo else '') %}

                <select name="genero" required>
                    <option value="" disabled {% if not selected_genero %}selected{% endif %}>Seleccione un género</option>
                    {% for g in lista_generos %}
                        <option value="{{ g }}" {% if selected_genero == g %}selected{% endif %}>
                            {{ g }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-calendar"></i> Año de Estreno:</label>
                    <input type="number" name="anio_estreno"
                           value="{% if error_message %}{{ form_data.anio_estreno }}{% elif titulo %}{{ titulo.anio_estreno }}{% endif %}"
                           min="1900" max="2030" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-clock"></i> Duración (minutos) o numero temporadas:</label>
                    <input type="number" name="duracion"
                           value="{% if error_message %}{{ form_data.duracion }}{% elif titulo %}{{ titulo.duracion }}{% endif %}"
                           min="1" required>
                </div>
            </div>

            <div class="form-group">
                <label><i class="fas fa-envelope"></i> Imagen:</label>
                <input type="file" name="img" accept="image/*" required>
                {% if accion == 'Editar' and titulo.img and titulo.img != '/static/img/placeholder_movie.jpg' %}
                    <small style="color: #888; display: block; margin-top: 5px;">Dejar vacío para mantener la imagen actual. (Se usa una imagen por defecto si no se sube una nueva)</small>
                {% else %}
                    <small style="color: #888; display: block; margin-top: 5px;">Se usará una imagen por defecto si no se sube un archivo.</small>
                {% endif %}
            </div>

            <div class="form-group">
                <label><i class="fas fa-align-left"></i> Descripción:</label>
                <textarea name="descripcion" rows="4" required>{% if error_message %}{{ form_data.descripcion }}{% elif titulo %}{{ titulo.descripcion }}{% endif %}</textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn {% if accion == 'Crear' %}btn-success{% else %}btn-primary{% endif %}">
                    <i class="fas fa-save"></i> {{ accion }}
                </button>
                <a href="/web/titulos" class="btn btn-secondary">Cancelar</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}